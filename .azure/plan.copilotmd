# Azure Deployment Plan for spring-petclinic

## Goal
Provision (only) Azure infrastructure for `spring-petclinic` using `azcli` + `Terraform` with AKS hosting.

## Project Scan Summary
- App: Spring PetClinic (`Java 17`, `Spring Boot 4`, server-side MVC with Thymeleaf)
- Service model: single web service listening on port `8080`
- Build systems: Maven (`pom.xml`) and Gradle (`build.gradle`)
- Existing deployment artifacts: `k8s/petclinic.yml`, `k8s/db.yml`, `docker-compose.yml`
- Data dependencies detected: H2 (default), MySQL and PostgreSQL profiles (`application-*.properties`)
- Target Azure dependencies for AKS deploy: ACR, AKS, Azure Database for PostgreSQL Flexible Server, Log Analytics, Application Insights, Key Vault

## Azure Architecture
```mermaid
graph TD
  A[petclinic Java service] --> B[AKS cluster]
  B --> C[Azure Container Registry]
  B --> D[Azure Database for PostgreSQL]
  B --> E[Azure Key Vault]
  B --> F[Application Insights]
  F --> G[Log Analytics Workspace]
```

## Recommended Resources
- AKS: Standard tier, Kubernetes default stable version for region (`az aks get-versions`), node size `Standard_D4ds_v5`, 2 nodes
- ACR: Standard SKU
- PostgreSQL Flexible Server: `B_Standard_B1ms`, version `16`, firewall rule allow Azure services (`0.0.0.0`)
- Application Insights: Workspace-based
- Key Vault: RBAC-enabled, public network enabled, stores DB connection values

## Execution Checklist
- [x] Analyze repository and runtime dependencies
- [x] Generate Azure plan with `mcp_c2c_appmod-get-plan`
- [x] Add Terraform files (`infra/main.tf`, `infra/main.tfvars.json`, `infra/outputs.tf`)
- [x] Add AKS deployment manifest (`k8s/aks/petclinic-aks.yaml`)
- [x] Add container build file (`Dockerfile`)
- [x] Add deployment script (`scripts/deploy-azure.ps1`)
- [ ] Run Terraform provision
- [ ] Build and push image to ACR (skipped: provision-only)
- [ ] Deploy manifests to AKS and verify rollout (skipped: provision-only)

## Run Command
From repo root:

```powershell
./scripts/deploy-azure.ps1 -SubscriptionId a4ab3025-1b32-4394-92e0-d07c1ebf3787 -Location eastus2
```

Optional full deployment (if needed later):

```powershell
./scripts/deploy-azure.ps1 -SubscriptionId a4ab3025-1b32-4394-92e0-d07c1ebf3787 -Location eastus2 -DeployApp
```
